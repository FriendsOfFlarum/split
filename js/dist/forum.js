(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var s in n)t.o(n,s)&&!t.o(o,s)&&Object.defineProperty(o,s,{enumerable:!0,get:n[s]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["forum/app"];var n=t.n(o);const s=flarum.core.compat["common/Model"];var i=t.n(s);const r=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/utils/PostControls"];var a=t.n(e);const l=flarum.core.compat["common/components/Button"];var c=t.n(l);const p=flarum.core.compat["forum/components/CommentPost"];var u=t.n(p);function f(t,o){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},f(t,o)}function d(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,f(t,o)}const _=flarum.core.compat["common/components/Modal"];var h=t.n(_);const b=flarum.core.compat["common/utils/Stream"];var v=t.n(b),w=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var s=o.prototype;return s.oninit=function(o){t.prototype.oninit.call(this,o),this.newDiscussionTitle=v()("")},s.className=function(){return"SplitPostModal Modal--small"},s.title=function(){return n().translator.trans("fof-split.forum.modal.title")},s.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"Form-group"},m("label",{for:"new_discussion_title"},n().translator.trans("fof-split.forum.modal.new_discussion_label")),m("input",{className:"FormControl",name:"new_discussion_title",bidi:this.newDiscussionTitle})),m("div",{className:"Form-group"},m(c(),{className:"Button Button--primary Button--block",type:"submit",loading:this.loading,disabled:!this.newDiscussionTitle()},n().translator.trans("fof-split.forum.modal.submit_button")))))]},s.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0;var s=new FormData;s.append("title",this.newDiscussionTitle()),s.append("start_post_id",n().__fof_split.splitController.startPostId),s.append("end_post_number",this.attrs.post.number()),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/split",serialize:function(t){return t},body:s}).then((function(t){var s={};s.id=v()(t.data.id),s.slug=v()(t.data.attributes.slug),s.startUser=v()(t.data.attributes.startUser),s.isUnread=v()(t.data.attributes.isUnread),n().__fof_split.splitController.reset(),o.hide(),m.route.set(n().route.discussion(s))}),this.loaded.bind(this))},o}(h()),y=function(){function t(){this.reset()}var o=t.prototype;return o.start=function(t,o){this.reset(),this.startPostId=t,n().__fof_split.splitting=!0,n().__fof_split.splittingFrom=o,m.redraw()},o.end=function(t){this.endPostNumber=t,n().__fof_split.splitting=!1},o.reset=function(){this.startPostId=null,this.endPostNumber=null,n().__fof_split.splitting=!1,n().__fof_split.splittingFrom=void 0},t}();const g=flarum.core.compat["common/components/EventPost"];var P=t.n(g);const N=flarum.core.compat["common/components/Link"];var S=t.n(N),B=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var n=o.prototype;return n.icon=function(){return"fas fa-code-branch"},n.descriptionKey=function(){return this.attrs.post.content().toNew?"fof-split.forum.post.was_split_to":"fof-split.forum.post.was_split_from"},n.descriptionData=function(){return{count:this.attrs.post.content().count,target:m(S(),{className:"EventPost-Split-target",href:this.attrs.post.content().url},this.attrs.post.content().title)}},o}(P());n().initializers.add("fof-split",(function(){window.app.__fof_split={splitting:!1,showSplitTos:{},splitController:null},window.app.__fof_split.splitController=new y,n().store.models.discussions.prototype.canSplit=i().attribute("canSplit"),n().postComponents.discussionSplit=B,(0,r.extend)(a(),"moderationControls",(function(t,o){var s=o.discussion();"comment"===o.contentType()&&s.canSplit()&&1!=o.number()&&(n().__fof_split.splitting||t.add("splitFrom",[m(c(),{icon:"fas fa-code-branch",className:"flagrow-split-startSplitButton",onclick:function(){n().__fof_split.splitController.start(o.id(),o.number())}},n().translator.trans("fof-split.forum.split.from"))]))})),(0,r.extend)(u().prototype,"oninit",(function(){this.subtree.check((function(){return n().__fof_split.splitting}))})),(0,r.extend)(u().prototype,"footerItems",(function(t){var o=this.attrs.post,s=o.discussion();"comment"===o.contentType()&&s.canSplit()&&1!==o.number()&&n().__fof_split.splitting&&o.number()>=n().__fof_split.splittingFrom&&t.add("splitTo",[m(c(),{icon:"fas fa-code-branch",className:"flagrow-split-endSplitButton Button Button--link",onclick:function(){n().modal.show(w,{post:o})}},n().translator.trans("fof-split.forum.split.to")),m(c(),{icon:"fas fa-times",className:"flagrow-split-cancelSplitButton Button Button--link",onclick:function(){n().__fof_split.splitController.reset(),m.redraw()}},n().translator.trans("fof-split.forum.split.cancel"))])}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map